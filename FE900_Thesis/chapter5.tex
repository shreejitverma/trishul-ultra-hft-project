\chapter{Software Control Plane Implementation}

This chapter details the design and implementation of the ultra-low-latency (ULL) software system. This software stack fulfills two critical roles within the broader research framework: it serves as a high-fidelity simulation environment for backtesting the reinforcement learning strategies, and it acts as the operational "Hybrid Control Plane" for the live FPGA system.

\section{Software System Architecture}

The software architecture is designed to minimize non-deterministic behavior introduced by the operating system and hardware caches. It employs a thread-per-core execution model, with critical components communicating via lock-free data structures. The architecture is visualized in Figure \ref{fig:sw_class_diagram}.

\begin{figure}[h!]
    \centering
    \caption{UML Component Diagram of the Software Engine}
    \label{fig:sw_class_diagram}
    \begin{tikzpicture}[node distance=1.5cm, auto]
        \tikzstyle{class} = [rectangle, draw, fill=yellow!10, text width=10em, text centered, rounded corners, minimum height=3em]
        \tikzstyle{line} = [draw, -latex', thick]
        
        \node [class] (oms) {\textbf{OrderManagementSystem} \\ +send\_order() \\ +on\_exec\_report()};
        \node [class, right=of oms] (sor) {\textbf{SmartOrderRouter} \\ +route()};
        \node [class, below=of oms] (strat) {\textbf{MarketMaker} \\ +on\_market\_data() \\ +get\_order()};
        \node [class, left=of strat] (book) {\textbf{OrderBookL2} \\ +update() \\ +best\_bid()};

        \path [line] (strat) -- node [right, scale=0.7] {Quote} (oms);
        \path [line] (oms) -- node [above, scale=0.7] {Route} (sor);
        \path [line] (strat) -- node [above, scale=0.7] {Query} (book);
        \path [line, dashed] (sor) -- node [below, scale=0.7] {OUCH 5.0 Stream} +(2.5,0);
    \end{tikzpicture}
\end{figure}

The event processing pipeline is segmented into six distinct stages:
\begin{enumerate}
    \item \textbf{Ingestion:} A `MulticastReceiver` interfaces with the network stack. To approximate the performance of hardware-based kernel bypass (e.g., DPDK), a `DMARingBuffer` simulation was implemented, allowing the system to process data with zero-copy semantics.
    \item \textbf{Market Data Normalization:} The `ITCHDecoder` parses raw binary messages into semantic events. These events update the `OrderBookL2`, which triggers a `DiffGenerator`. This generator optimizes downstream processing by notifying the strategy only when the Best Bid or Offer (BBO) changes.
    \item \textbf{Strategy Execution:} The `MarketMaker` strategy receives BBO updates. It calculates an Order Book Imbalance (OBI) signal and applies a skew to the mid-price to generate optimal quotes.
    \item \textbf{Risk Validation:} A `PretradeChecker` enforces a safety layer, validating every generated order against Position and Notional limits before it is permitted to leave the strategy thread.
    \item \textbf{Order Execution:} Validated orders are encoded into the binary NASDAQ OUCH 5.0 format by the `OUCHCodec` and dispatched to the simulated exchange.
    \item \textbf{Observability:} An `AsyncLogger` captures diagnostic data. By utilizing a lock-free ring buffer, logging operations are offloaded to a background thread, ensuring zero latency penalty on the critical trading path.
\end{enumerate}

\section{Core Implementation Details}

\subsection{Exchange Simulation (Matching Engine)}
A robust evaluation of any market-making strategy requires a realistic counterparty. We implemented a fully functional `MatchingEngine` to simulate the exchange. Unlike simplistic backtesters that assume fills based on historical mid-prices, this engine maintains a separate Limit Order Book and executes orders according to strict \textbf{Price-Time Priority}. This ensures that the strategy is tested against realistic constraints, including queue position and partial fills.

\subsection{Vectorized Signal Engine}
To support the computational demands of the RL strategy, a `SignalEngine` was developed using \textbf{AVX2 SIMD} intrinsics. This engine vectorizes the calculation of technical indicators such as the Relative Strength Index (RSI) and Standard Deviation. By processing batches of price data in parallel 256-bit registers, the software control plane can recalculate model parameters over millions of historical ticks in under 200 milliseconds.

\subsection{Direct Market Access Protocol (OUCH 5.0)}
To ensure the system's readiness for deployment, the text-based order entry protocols often used in academic simulations were replaced with a native `OUCHCodec`. This component strictly adheres to the NASDAQ OUCH 5.0 specification, packing order fields into compact, Little-Endian binary structures. This verifies that the system can interface correctly with production-grade exchange gateways.