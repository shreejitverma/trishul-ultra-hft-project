# API Reference

This document details the public interfaces of the core C++ components.

## 1. Strategy & Logic

### `ultra::strategy::MarketMaker`
Located in `include/ultra/strategy/market_maker.hpp`.
A generic Liquidity Provision strategy.

*   `MarketMaker(SymbolId symbol_id)`
    *   Initializes the strategy for a specific symbol.
*   `void on_market_data(const DecodedMessage& msg)`
    *   Updates the internal book. Triggers quote generation on BBO change.
*   `bool get_order(StrategyOrder& order)`
    *   Populates `order` with a generated Buy/Sell limit order if available.
*   **Key Logic:** Calculates **Order Book Imbalance (OBI)** to skew quotes around the mid-price.

### `ultra::strategy::SignalEngine`
Located in `include/ultra/strategy/signal_engine.hpp`.
Vectorized calculation engine.

*   `static std::vector<double> sma(const std::vector<double>& prices, int window)`
    *   AVX2-optimized Simple Moving Average.
*   `static std::vector<double> rsi(const std::vector<double>& prices, int period)`
    *   Relative Strength Index calculation.
*   `static void batch_compare_gt(const double* a, const double* b, size_t n, uint8_t* result)`
    *   SIMD batch comparison for signal generation.

### `ultra::core::SymbolUniverse`
Located in `include/ultra/core/symbol_universe.hpp`.

*   `static SymbolUniverse& instance()`
    *   Singleton access.
*   `void add_symbol(const SymbolInfo& info)`
    *   Registers a new symbol.
*   `const SymbolInfo* get_symbol(SymbolId id)`
    *   O(1) lookup of symbol metadata.

---

## 2. Execution & Protocols

### `ultra::exec::MatchingEngine`
Located in `include/ultra/execution/matching_engine.hpp`.
Simulates an exchange matching logic.

*   `void process_order(const StrategyOrder& order)`
    *   Matches incoming order against the resting book (Price-Time Priority).
*   `bool pop_fill(ExecutionReport& fill)`
    *   Retrieves execution reports (Fills/Partials) generated by the engine.

### `ultra::ouch::OUCHCodec`
Located in `include/ultra/market-data/ouch/ouch_codec.hpp`.
Encodes orders into OUCH 5.0 binary format.

*   `static void encode_enter_order(vector<uint8_t>& buf, ...)`
    *   Packs order details into a Little-Endian `EnterOrder` struct for network transmission.

---

## 3. Infrastructure & Utils

### `ultra::AsyncLogger`
Located in `include/ultra/core/async_logger.hpp`.
Zero-latency logging utility.

*   `void start(const std::string& filename)`
    *   Starts the background flush thread.
*   `ULTRA_LOG(fmt, ...)`
    *   Macro for non-blocking formatted logging. Pushes to a lock-free ring buffer.

### `ultra::ThreadUtils`
Located in `include/ultra/core/thread_utils.hpp`.

*   `static void isolate_thread(int core_id)`
    *   Pins thread to a core and sets `SCHED_FIFO` real-time priority.

### `ultra::MemoryUtils`
Located in `include/ultra/core/memory/memory_utils.hpp`.

*   `static void lock_memory()`
    *   Calls `mlockall` to prevent swapping.
*   `static void prefault_buffer(void* ptr, size_t size)`
    *   Touches memory pages to force physical allocation.

---

## 4. Risk Management

### `ultra::risk::PretradeChecker`
Located in `include/ultra/risk/pretrade_checker.hpp`.

*   `bool check_order(const StrategyOrder& order)`
    *   Validates order against Max Size, Position Limits, and Notional value.
    *   Returns `true` if safe to send, `false` otherwise.